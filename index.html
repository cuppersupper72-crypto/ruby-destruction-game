<!DOCTYPE html>
<html>
<head>
<title>Ruby Saga Revolution</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  font-family:Arial;
  text-align:center;
  background:black;
  color:white;
  margin:0;
  overflow:hidden;
  transition:background 0.3s;
}
#ui{padding:10px;}
#ruby{font-size:65px;margin:10px;}
.element{
  display:inline-block;
  padding:8px;
  margin:4px;
  background:crimson;
  border-radius:6px;
  cursor:pointer;
}
#gameArea{
  position:relative;
  width:100%;
  height:60vh;
  background:darkblue;
  display:none;
  overflow:hidden;
}
#player{
  position:absolute;
  width:40px;
  height:40px;
  background:lime;
  left:50px;
  top:50px;
}
.house{
  position:absolute;
  width:50px;
  height:50px;
  background:brown;
}
#controls{
  position:fixed;
  bottom:15px;
  left:50%;
  transform:translateX(-50%);
  display:none;
}
.control-btn{
  width:60px;
  height:60px;
  margin:5px;
  font-size:24px;
  border:none;
  border-radius:10px;
  background:#444;
  color:white;
}
.cutscene{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:black;
  display:flex;
  justify-content:center;
  align-items:center;
  flex-direction:column;
  font-size:28px;
  z-index:9999;
}
.shake{animation:shake 0.3s infinite;}
@keyframes shake{
  0%{transform:translate(2px,2px);}
  50%{transform:translate(-2px,-3px);}
  100%{transform:translate(2px,-2px);}
}
.flash{animation:flash 0.2s infinite alternate;}
@keyframes flash{
  from{background:black;}
  to{background:purple;}
}
</style>
</head>
<body>

<div id="ui">
<h2>üíé Ruby Saga Revolution</h2>
<div id="ruby">üíé</div>
<div id="elements"></div>
<p id="message">The ruby hums with power...</p>
<p id="final"></p>
<button onclick="fightRobots()">Fight Robots</button>
</div>

<div id="gameArea">
  <div id="player"></div>
  <div class="house" style="left:200px;top:120px;"></div>
  <div class="house" style="left:350px;top:200px;"></div>
  <div class="house" style="left:150px;top:300px;"></div>
</div>

<div id="controls">
  <div><button class="control-btn" ontouchstart="moveUp()">‚¨ÜÔ∏è</button></div>
  <div>
    <button class="control-btn" ontouchstart="moveLeft()">‚¨ÖÔ∏è</button>
    <button class="control-btn" ontouchstart="moveDown()">‚¨áÔ∏è</button>
    <button class="control-btn" ontouchstart="moveRight()">‚û°Ô∏è</button>
  </div>
</div>

<script>
let inventory=["fire","water","energy","gravity","dark","air"];
let selected=[];
let planetStage=false;
let rayBuilt=false;
let armyCount=0;
let px=50, py=50;

const player=document.getElementById("player");
const gameArea=document.getElementById("gameArea");
const controls=document.getElementById("controls");

function renderElements(){
  const container=document.getElementById("elements");
  container.innerHTML="";
  inventory.forEach(el=>{
    const div=document.createElement("div");
    div.className="element";
    div.innerText=el;
    div.onclick=()=>selectElement(el);
    container.appendChild(div);
  });
}

function selectElement(el){
  selected.push(el);
  document.getElementById("message").innerText="Selected: "+selected.join(" + ");
  if(selected.length===2){
    combine();
    selected=[];
  }
}

function combine(){
  const combo=selected.sort().join("-");

  if(combo==="fire-water") addElement("steam");
  else if(combo==="fire-gravity") addElement("lava");
  else if(combo==="lava-water") addElement("obsidian");
  else if(combo==="water-gravity") addElement("wave");
  else if(combo==="air-water") addElement("storm");
  else if(combo==="storm-energy") addElement("lightning");
  else if(combo==="obsidian-energy") addElement("core");
  else if(combo==="core-dark") addElement("voidcore");
  else if(combo==="energy-fire") addElement("plasma");
  else if(combo==="dark-gravity") addElement("blackhole");
  else if(combo==="energy-plasma") addElement("supercharge");
  else if(combo==="blackhole-supercharge") destroyRuby();
  else document.getElementById("message").innerText="Nothing formed...";
}

function addElement(el){
  if(!inventory.includes(el)){
    inventory.push(el);
    document.getElementById("message").innerText="New element: "+el;
    renderElements();
  }
}

function destroyRuby(){
  const ruby=document.getElementById("ruby");
  ruby.classList.add("shake");
  document.body.classList.add("flash");
  document.getElementById("message").innerText="The Ruby destabilizes!";
  setTimeout(()=>{
    ruby.classList.remove("shake");
    document.body.classList.remove("flash");
    ruby.innerText="üí•";
    setTimeout(nextPlanet,2000);
  },3000);
}

function nextPlanet(){
  planetStage=true;
  document.body.style.background="darkblue";
  document.getElementById("ruby").innerText="ü™ê";
  document.getElementById("message").innerText="Build the Ray Gun!";
  inventory=["metal","crystal","energy"];
  renderElements();
  gameArea.style.display="block";
  controls.style.display="block";
  startRayCutscene();
}

function startRayCutscene(){
  const scene=createScene("‚öôÔ∏è Building Ray Gun...");
  setTimeout(()=>scene.innerText="üíé Installing crystal core...",1500);
  setTimeout(()=>scene.innerText="‚ö° Charging weapon...",3000);
  setTimeout(()=>{
    scene.innerText="üî´ Ray Gun Complete!";
    rayBuilt=true;
  },4500);
  setTimeout(()=>scene.remove(),6000);
}

function moveUp(){py-=15;update();}
function moveDown(){py+=15;update();}
function moveLeft(){px-=15;update();}
function moveRight(){px+=15;update();}

function update(){
  player.style.left=px+"px";
  player.style.top=py+"px";
  checkHouse();
}

function checkHouse(){
  const houses=document.querySelectorAll(".house");
  houses.forEach(h=>{
    if(Math.abs(px-h.offsetLeft)<40 && Math.abs(py-h.offsetTop)<40){
      recruitCutscene(h);
    }
  });
}

function recruitCutscene(house){
  house.remove();
  const scene=createScene("üè† Speaking to villagers...");
  setTimeout(()=>scene.innerText="üßë They listen...",1500);
  setTimeout(()=>scene.innerText="‚öîÔ∏è They join the revolution!",3000);
  setTimeout(()=>{
    armyCount++;
    scene.remove();
    document.getElementById("message").innerText="Army: "+armyCount;
  },4500);
}

function fightRobots(){
  if(!rayBuilt || armyCount<3){
    document.getElementById("final").innerText="You need Ray Gun + 3 recruits.";
    return;
  }

  const scene=createScene("‚öîÔ∏è Final Battle!");
  scene.innerHTML+=`
    <div style="width:300px;background:#333;height:20px;margin-top:20px;">
      <div id="hp" style="width:100%;height:100%;background:red;"></div>
    </div>
  `;
  let hp=100;
  const bar=document.getElementById("hp");

  const battle=setInterval(()=>{
    hp-=10;
    if(hp<0) hp=0;
    bar.style.width=hp+"%";
    if(hp<=0){
      clearInterval(battle);
      scene.innerText="üí• Boss Defeated!";
      setTimeout(()=>{
        scene.remove();
        document.getElementById("final").innerText="üèÜ Planet Liberated!";
      },2000);
    }
  },1000);
}

function createScene(text){
  const div=document.createElement("div");
  div.className="cutscene";
  div.innerText=text;
  document.body.appendChild(div);
  return div;
}

renderElements();
</script>

</body>
</html>