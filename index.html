<!DOCTYPE html>
<html>
<head>
<title>Ruby Saga Revolution</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
body{
  font-family:Arial;
  text-align:center;
  background:black;
  color:white;
  padding:20px;
  transition:background 0.5s;
}
#ruby{font-size:70px;margin:20px;}
.shake{animation:shake 0.3s infinite;}
@keyframes shake{
  0%{transform:translate(2px,2px);}
  50%{transform:translate(-2px,-3px);}
  100%{transform:translate(2px,-2px);}
}
.flash{animation:flash 0.2s infinite alternate;}
@keyframes flash{
  from{background:black;}
  to{background:purple;}
}
.element{
  display:inline-block;
  padding:10px;
  margin:5px;
  background:crimson;
  border-radius:8px;
  cursor:pointer;
}
.cutscene{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  background:black;
  color:white;
  display:flex;
  flex-direction:column;
  justify-content:center;
  align-items:center;
  font-size:28px;
  z-index:9999;
}
</style>
</head>
<body>

<h1>ğŸ’ Ruby Saga Revolution</h1>
<div id="ruby">ğŸ’</div>
<h3>Tap Two Elements To Combine</h3>
<div id="elements"></div>
<p id="message">The ruby feels unstoppable...</p>
<p id="final"></p>

<script>
let inventory=["fire","water","energy","gravity","dark","air"];
let selected=[];
let planetStage=false;
let rayBuilt=false;
let armyCount=0;

function renderElements(){
  const container=document.getElementById("elements");
  container.innerHTML="";
  inventory.forEach(el=>{
    const div=document.createElement("div");
    div.className="element";
    div.innerText=el;
    div.onclick=()=>selectElement(el);
    container.appendChild(div);
  });
}

function selectElement(el){
  if(planetStage && !rayBuilt){
    startRayCutscene();
    return;
  }

  selected.push(el);
  document.getElementById("message").innerText=
    "Selected: "+selected.join(" + ");

  if(selected.length===2){
    combine();
    selected=[];
  }
}

function combine(){
  const combo=selected.sort().join("-");

  // Expanded crafting tree
  if(combo==="fire-water") addElement("steam");
  else if(combo==="fire-gravity") addElement("lava");
  else if(combo==="lava-water") addElement("obsidian");
  else if(combo==="water-gravity") addElement("wave");
  else if(combo==="air-water") addElement("storm");
  else if(combo==="storm-energy") addElement("lightning");
  else if(combo==="obsidian-energy") addElement("core");
  else if(combo==="core-dark") addElement("voidcore");
  else if(combo==="energy-fire") addElement("plasma");
  else if(combo==="dark-gravity") addElement("blackhole");
  else if(combo==="energy-plasma") addElement("supercharge");
  else if(combo==="blackhole-supercharge") destroyRuby();
  else document.getElementById("message").innerText="Nothing formed...";
}

function addElement(newEl){
  if(!inventory.includes(newEl)){
    inventory.push(newEl);
    document.getElementById("message").innerText="New element: "+newEl;
    renderElements();
  }
}

function destroyRuby(){
  const ruby=document.getElementById("ruby");
  ruby.classList.add("shake");
  document.body.classList.add("flash");
  document.getElementById("message") .innerText="The Ruby destabilizes...";
  setTimeout(()=>{
    ruby.classList.remove("shake");
    document.body.classList.remove("flash");
    ruby.innerText="ğŸ’¥";
    document.getElementById("message").innerText="A portal opens!";
    setTimeout(nextPlanet,2000);
  },3000);
}

function nextPlanet(){
  planetStage=true;
  document.body.style.background="darkblue";
  document.getElementById("ruby").innerText="ğŸª";
  document.getElementById("message").innerText=
    "ğŸ¤– Robots detected. Build a Ray Gun.";
  inventory=["metal","crystal","energy"];
  renderElements();
}

function startRayCutscene(){
  if(rayBuilt) return;

  document.body.innerHTML+=`
    <div class="cutscene" id="rayScene">
      <div id="rayText">âš™ï¸ Gathering parts...</div>
    </div>
  `;

  const steps=[
    "âš™ï¸ Assembling metal frame...",
    "ğŸ’ Installing crystal core...",
    "âš¡ Charging with energy...",
    "ğŸ”« Ray Gun Activated!"
  ];

  let i=0;
  const interval=setInterval(()=>{
    i++;
    if(i<steps.length){
      document.getElementById("rayText").innerText=steps[i];
    } else{
      clearInterval(interval);
      rayBuilt=true;
      setTimeout(()=>{
        document.getElementById("rayScene").remove();
        startRecruitCutscene();
      },1500);
    }
  },1500);
}

function startRecruitCutscene(){
  document.body.innerHTML+=`
    <div class="cutscene" id="recruitScene">
      <div id="recruitText">ğŸ  Visiting villages...</div>
    </div>
  `;

  const steps=[
    "ğŸ§‘ You speak of freedom...",
    "ğŸ‘¥ People begin to listen...",
    "âš”ï¸ They join your revolution!",
    "ğŸš€ Army Ready!"
  ];

  let i=0;
  const interval=setInterval(()=>{
    i++;
    if(i<steps.length){
      document.getElementById("recruitText").innerText=steps[i];
    } else{
      clearInterval(interval);
      armyCount=3;
      setTimeout(()=>{
        document.getElementById("recruitScene").remove();
        document.getElementById("message").innerText=
          "Your army stands ready.";
      },1500);
    }
  },1500);
}

function fightRobots(){
  if(!rayBuilt || armyCount<3){
    document.getElementById("final").innerText=
      "You need a Ray Gun and army.";
    return;
  }

  document.body.innerHTML+=`
    <div id="battleScene" class="cutscene">
      <div id="battleText">âš”ï¸ The Final Battle Begins...</div>
      <div style="margin:20px;font-size:60px;">ğŸ§‘â€ğŸš€ğŸ§‘â€ğŸš€ğŸ§‘â€ğŸš€ âš¡ ğŸ¤–ğŸ‘‘</div>
      <div style="width:300px;background:#333;height:20px;">
        <div id="robotHealth" style="width:100%;height:100%;background:red;"></div>
      </div>
    </div>
  `;

  let health=100;
  const bar=document.getElementById("robotHealth");
  const scene=document.getElementById("battleScene");

  const interval=setInterval(()=>{
    health-=15;
    if(health<0) health=0;
    bar.style.width=health+"%";

    scene.style.background="darkred";
    setTimeout(()=>scene.style.background="black",150);

    if(health<=0){
      clearInterval(interval);
      document.getElementById("battleText").innerText=
        "ğŸ’¥ The Boss Robot Falls!";
      setTimeout(()=>{
        scene.remove();
        document.getElementById("final").innerText=
          "ğŸ† Victory! The planet is free!";
      },2000);
    }
  },1000);
}

renderElements();
</script>
<br>
<button onclick="fightRobots()">Fight Robots</button>
</body>
</html>